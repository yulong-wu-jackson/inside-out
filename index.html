<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>On the Clock</title>
  
  <!-- CSS: Landing page, fixed graphic panel, and narrative steps -->
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      overflow-x: hidden;
    }
    /* LANDING PAGE: Full viewport, covers the graphic until scrolled away */
    .landing {
      height: 100vh;
      background: #f7f7f7;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
      position: relative;
      z-index: 20;
    }
    .landing h1 {
      font-size: 3em;
      margin-bottom: 1rem;
    }
    .landing p {
      font-size: 1.2em;
    }
    /* SCROLLTELLING SECTION */
    .scrollytelling {
      position: relative;
      /* Provide extra vertical space for scrolling */
      padding-bottom: 200vh;
    }
    /* Left fixed graphic panel (revealed after landing scrolls away) */
    .graphic-container {
      position: fixed;
      left: 0;
      top: 0;
      width: 50vw;
      height: 100vh;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      border-right: 1px solid #ccc;
    }
    /* Right scrollable text container */
    .text-container {
      position: relative;
      margin-left: 50vw;
      width: 50vw;
      padding: 2rem;
    }
    /* Narrative step styling */
    .step {
      margin: 150px 0;
      padding: 1.5rem;
      background: #fff;
      border-left: 4px solid #ccc;
    }
    .step h2 {
      margin-bottom: 0.5rem;
    }

    /* Scroll Indicator (pointing down arrow) for Landing Page */
    .scroll-indicator {
        position: absolute;
        bottom: 200px;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
    }
    .scroll-indicator .arrow {
        width: 24px;
        height: 24px;
        border-left: 2px solid #333;
        border-bottom: 2px solid #333;
        transform: rotate(-45deg);
        margin: 0 auto;
        animation: bounce 2s infinite;
    }
    .scroll-indicator .scroll-text {
        margin-top: 10px;
        font-size: 0.9em;
        color: #333;
        animation: bounceNoRotate 2s infinite;
    }
    @keyframes bounce {
        0% { transform: translateY(0) rotate(-45deg); opacity: 1; }
        50% { transform: translateY(10px) rotate(-45deg); opacity: 0.02; }
        100% { transform: translateY(0) rotate(-45deg); opacity: 1; }
    }
    @keyframes bounceNoRotate {
        0% { transform: translateY(0); opacity: 1; }
        50% { transform: translateY(10px); opacity: 0.02; }
        100% { transform: translateY(0); opacity: 1; }
    }

    /* food delivery animation section */

    /* Ensure the animation container has a background */
    /* Ensure the animation container has a background */
    #delivery-animation {
        background: rgb(255, 255, 255);
    }

    


    /* food delivery animation section */

  </style>
  
  <!-- Load D3 (v7) and scrollama from CDN -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/scrollama"></script>
</head>
<body>
  <!-- FULL-PAGE LANDING (covers the graphic panel) -->
  <div class="landing">
    <h1>On the Clock</h1>
    <p>Scroll down to begin the interactive experience.</p>

    <!-- food delivery animation section -->

    <!-- Food Delivery Man Animation Section -->

    <!-- Food Delivery Motorbike Animation Section -->
    <!-- create a bigger space for the inclusion of the motorbike animation -->
     <div style="width: 800px; height: 110px; overflow: hidden;">
        <div id="frontpage-motorbike-animation" style="width: 110px; height: 110px; overflow: hidden;">
            <img id="motorbike-svg" src="/svg/noun-food-delivery-7279793.svg" alt="Motorbike">
        </div>
     </div>
    
  
    
  
    <!-- food delivery animation section -->

    <!-- Scroll Indicator: pointing down arrow -->
    <div class="scroll-indicator">
        <div class="arrow"></div>
        <div class="scroll-text">scroll</div>
    </div>
  
  </div>
  
  <!-- SCROLLTELLING SECTION -->
  <div class="scrollytelling">
    <!-- Left fixed graphic panel -->
    <div class="graphic-container">
      <svg id="graphic-svg" width="500" height="500">
        <!-- Group for the first visualization (a circle) -->
        <g id="vis1">
          <!-- The circle is created below -->
        </g>
        <!-- Group for the second visualization (a bar chart) -->
        <g id="vis2" style="opacity:0">
          <!-- The bar chart will be created here -->
        </g>
      </svg>
    </div>
    
    <!-- Right scrollable narrative text -->
    <div class="text-container">
      <!-- Steps controlling the first visualization (vis1) -->
      <div class="step" data-vis="vis1" data-step="1">
        <h2>Step 1: Introduction</h2>
        <p>This page introduces the circle. The left visual is fixed and waits for you to scroll.</p>
        <!-- add some blank space in the web page -->
        <div style="height: 100px;"></div>
      </div>
      <div class="step" data-vis="vis1" data-step="2">
        <h2>Step 2: Transformation</h2>
        <p>As you scroll, the circle grows and shifts its color gradually.</p>
        <!-- add some blank space in the web page -->
        <div style="height: 100px;"></div>
      </div>
      <div class="step" data-vis="vis1" data-step="3">
        <h2>Step 3: Preparing for Transition</h2>
        <p>The circle reaches its final state before transitioning.</p>
        <!-- add some blank space in the web page -->
        <div style="height: 100px;"></div>
      </div>
      
      <!-- Transition step: animate the first visualization flying away and reveal the second -->
      <div class="step" data-vis="transition" data-step="1">
        <h2>Transition</h2>
        <p>The circle flies off to reveal the new visualization.</p>
        <!-- add some blank space in the web page -->
        <div style="height: 100px;"></div>
      </div>
      
      <!-- Steps controlling the second visualization (vis2) -->
      <div class="step" data-vis="vis2" data-step="1">
        <h2>Step 4: New Visualization Intro</h2>
        <p>The bar chart appears as you scroll; its bars fade in.</p>
        <!-- add some blank space in the web page -->
        <div style="height: 100px;"></div>
      </div>
      <div class="step" data-vis="vis2" data-step="2">
        <h2>Step 5: Bar Chart Update</h2>
        <p>The bars adjust their heights and change color progressively.</p>
        <!-- add some blank space in the web page -->
        <div style="height: 100px;"></div>
      </div>
      <div class="step" data-vis="vis2" data-step="3">
        <h2>Step 6: Conclusion</h2>
        <p>The final state of the bar chart is reached as you complete this section.</p>
        <!-- add some blank space in the web page -->
        <div style="height: 100px;"></div>
      </div>
    </div>
  </div>
  
  <!-- JavaScript: D3 visualizations and scrollama progress-linked updates -->
  <script>
    // Select the SVG and its groups
    const svg = d3.select("#graphic-svg");
    const vis1 = d3.select("#vis1");
    const vis2 = d3.select("#vis2");
    
    // ----------------------------
    // FIRST VISUALIZATION: Circle (vis1)
    // ----------------------------
    // Append a circle with the initial (state1) attributes:
    // state1: { r: 50, cx: 250, fill: "steelblue" }
    const circle = vis1.append("circle")
                       .attr("cx", 250)
                       .attr("cy", 250)
                       .attr("r", 50)
                       .attr("fill", "steelblue");
    
    // Define the target states for vis1:
    const state1 = { r: 50, cx: 250, fill: "steelblue" };
    const state2 = { r: 70, cx: 200, fill: "orange" };
    const state3 = { r: 40, cx: 300, fill: "green" };
    
    // ----------------------------
    // SECOND VISUALIZATION: Bar Chart (vis2)
    // ----------------------------
    // Weâ€™ll use two data arrays for the bars:
    const data1 = [30, 80, 45]; // initial bar heights
    const data2 = [60, 40, 70]; // target bar heights
    
    // ----------------------------
    // scrollama Setup with Progress (continuous updates)
    // ----------------------------
    const scroller = scrollama();
    
    scroller.setup({
      step: ".step",
      offset: 0.5,
      progress: true,
      debug: false
    })
    .onStepProgress(response => {
      // response contains:
      //   progress: a number between 0 and 1
      //   element: the .step element
      //   index, direction, etc.
      const visType = response.element.getAttribute("data-vis");
      const step = +response.element.getAttribute("data-step");
      const p = response.progress; // progress within this step
      
      if (visType === "vis1") {
        // --- vis1 (circle) continuous updates ---
        if (step === 1) {
          // For step 1, we simply show state1 (no interpolation needed)
          circle.attr("r", state1.r)
                .attr("cx", state1.cx)
                .attr("fill", state1.fill);
        } else if (step === 2) {
          // Interpolate from state1 to state2
          const r = state1.r + (state2.r - state1.r) * p;
          const cx = state1.cx + (state2.cx - state1.cx) * p;
          const fill = d3.interpolateRgb(state1.fill, state2.fill)(p);
          circle.attr("r", r)
                .attr("cx", cx)
                .attr("fill", fill);
        } else if (step === 3) {
          // Interpolate from state2 to state3
          const r = state2.r + (state3.r - state2.r) * p;
          const cx = state2.cx + (state3.cx - state2.cx) * p;
          const fill = d3.interpolateRgb(state2.fill, state3.fill)(p);
          circle.attr("r", r)
                .attr("cx", cx)
                .attr("fill", fill);
        }
      } else if (visType === "transition") {
        // --- Transition from vis1 to vis2 ---
        // Move vis1 off-screen and fade it out while fading vis2 in.
        vis1.attr("transform", "translate(" + (-600 * p) + ",0)")
            .style("opacity", 1 - p);
        vis2.style("opacity", p);
      } else if (visType === "vis2") {
        // --- vis2 (bar chart) continuous updates ---
        if (step === 1) {
          // For step 1, create the bars if they donâ€™t exist and fade them in.
          if (vis2.selectAll("rect").empty()) {
            vis2.selectAll("rect")
              .data(data1)
              .enter()
              .append("rect")
              .attr("x", (d, i) => 50 + i * 70)
              .attr("width", 50)
              .attr("y", d => 500 - d)
              .attr("height", d => d)
              .attr("fill", "teal")
              .attr("opacity", 0);
          }
          vis2.selectAll("rect")
            .attr("opacity", p);
        } else if (step === 2) {
          // Interpolate bar heights and fill from data1 to data2.
          vis2.selectAll("rect").each(function(d, i) {
            const newHeight = data1[i] + (data2[i] - data1[i]) * p;
            d3.select(this)
              .attr("height", newHeight)
              .attr("y", 500 - newHeight)
              .attr("fill", d3.interpolateRgb("teal", "purple")(p))
              .attr("opacity", 1);
          });
        } else if (step === 3) {
          // Interpolate bar fill from purple to red.
          vis2.selectAll("rect")
            .attr("fill", d3.interpolateRgb("purple", "red")(p));
        }
      }
    });
    
    window.addEventListener("resize", scroller.resize);

    // food delivery motorbike animation section
    function animateMotorBike() {
        var bike = d3.select("#frontpage-motorbike-animation");
        // Reset to start: off-screen left with zero opacity
        bike.style("transform", "translateX(0px)")
            .style("opacity", 0)
        // Transition from left off-screen to center while fading in
        .transition()
            .duration(5000)
            .ease(d3.easeLinear)
            .style("transform", "translateX(600px)")
            .style("opacity", 1)
        // Transition from center to off-screen right while fading out
        .transition()
            .duration(1000)
            .ease(d3.easeLinear)
            .style("transform", "translateX(700px)")
            .style("opacity", 0)
            .on("end", animateMotorBike);  // Loop the animation
  }
  
  // Start the animation
  animateMotorBike();
    


  </script>
</body>
</html>
